{% extends 'base.html' %}
{% block title %}Problem D - Supervisor{% endblock %}
{% block content %}
<section class="section">
  <div class="section-header"><h2>{{ title }}</h2><span class="tag">Role: Supervisor</span></div>
  <form class="filter-row" method="get">
    <label>Sector ID<input type="text" name="location_id" value="{{ location_id }}" placeholder="SEC001"></label>
    <button class="btn primary" type="submit">Apply</button>
  </form>
  <div class="stat-grid">
    <div class="stat-card"><div><div class="stat-value">{{ awc_rows|length }}</div><div class="stat-label">Total AWCs</div></div></div>
    <div class="stat-card"><div><div class="stat-value">{{ improving_pct }}%</div><div class="stat-label">Avg Improvement %</div></div></div>
    <div class="stat-card"><div><div class="stat-value">{% if awc_rows %}{{ awc_rows.0.awc_id }}{% else %}N/A{% endif %}</div><div class="stat-label">Highest Improving AWC</div></div></div>
    <div class="stat-card"><div><div class="stat-value">{% if awc_rows %}{{ awc_rows|last.awc_id }}{% else %}N/A{% endif %}</div><div class="stat-label">Lowest Performing AWC</div></div></div>
    <div class="stat-card"><div><div class="stat-value">{{ chronic_cases }}</div><div class="stat-label">Chronic Case Count</div></div></div>
  </div>
</section>

<section class="section">
  <div class="section-header"><h2>AWC Comparison</h2></div>
  <div class="table-wrap">
    <table class="kpi-table">
      <thead><tr><th>AWC</th><th>Improvement %</th><th>Worsening %</th><th>Chronic Cases</th><th>Avg Referral Time</th></tr></thead>
      <tbody>
      {% for row in awc_rows %}
        <tr><td>{{ row.awc_id }}</td><td>{{ row.improving_pct }}%</td><td>{{ row.worsening_pct }}%</td><td>{{ row.chronic_cases }}</td><td>{{ row.avg_referral_days }}</td></tr>
      {% empty %}
        <tr><td colspan="5">No AWC comparison data.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="section">
  <div class="section-header"><h2>Trend Over Time</h2></div>
  <div class="table-wrap">
    <table class="kpi-table">
      <thead><tr><th>Month</th><th>High Risk %</th></tr></thead>
      <tbody>
      {% for row in trend_rows %}
        <tr><td>{{ row.month }}</td><td>{{ row.high_risk_pct }}%</td></tr>
      {% empty %}
        <tr><td colspan="2">No trend data.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
