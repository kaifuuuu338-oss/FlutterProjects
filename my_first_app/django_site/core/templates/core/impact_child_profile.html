{% extends 'base.html' %}
{% block title %}Child Longitudinal Profile{% endblock %}
{% block content %}
<section class="section">
  <div class="section-header"><h2>{{ title }}</h2><span class="tag">Problem D</span></div>
  <div class="stat-grid">
    <div class="stat-card"><div><div class="stat-value">{{ child.name }}</div><div class="stat-label">Name</div></div></div>
    <div class="stat-card"><div><div class="stat-value">{{ child.gender|default:"-" }}</div><div class="stat-label">Gender</div></div></div>
    <div class="stat-card"><div><div class="stat-value">{{ child.awc_id|default:"-" }}</div><div class="stat-label">AWC</div></div></div>
  </div>
</section>

<section class="section">
  <div class="section-header"><h2>Risk Timeline</h2></div>
  <div class="table-wrap">
    <table class="kpi-table">
      <thead><tr><th>Date</th><th>Risk</th><th>Risk Score (1-4)</th></tr></thead>
      <tbody>
      {% for row in risk_timeline %}
        <tr><td>{{ row.date }}</td><td>{{ row.risk }}</td><td>{{ row.risk_score }}</td></tr>
      {% empty %}
        <tr><td colspan="3">No risk timeline available.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="section">
  <div class="section-header"><h2>Domain Score Trend</h2></div>
  <div class="table-wrap">
    <table class="kpi-table">
      <thead><tr><th>Date</th><th>GM</th><th>FM</th><th>LC</th><th>COG</th><th>SE</th></tr></thead>
      <tbody>
      {% for row in domain_timeline %}
        <tr><td>{{ row.date }}</td><td>{{ row.GM }}</td><td>{{ row.FM }}</td><td>{{ row.LC }}</td><td>{{ row.COG }}</td><td>{{ row.SE }}</td></tr>
      {% empty %}
        <tr><td colspan="6">No domain trend data.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="section">
  <div class="section-header"><h2>Intervention History</h2></div>
  <div class="table-wrap">
    <table class="kpi-table">
      <thead><tr><th>Start Date</th><th>Intervention Type</th><th>Status</th><th>Outcome</th></tr></thead>
      <tbody>
      {% for row in intervention_rows %}
        <tr><td>{{ row.start_date }}</td><td>{{ row.intervention_type }}</td><td>{{ row.status }}</td><td>{{ row.outcome }}</td></tr>
      {% empty %}
        <tr><td colspan="4">No intervention history.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="section">
  <div class="section-header"><h2>Referral History</h2></div>
  <div class="table-wrap">
    <table class="kpi-table">
      <thead><tr><th>Date</th><th>Referral Type</th><th>Completed</th><th>Improvement After Referral</th></tr></thead>
      <tbody>
      {% for row in referrals %}
        <tr>
          <td>{{ row.referral_date }}</td>
          <td>{{ row.referral_status }}</td>
          <td>{% if row.completion_date %}Yes{% else %}No{% endif %}</td>
          <td>{% if row.referral_status == 'Completed' %}Improvement tracked in follow-up{% else %}Pending{% endif %}</td>
        </tr>
      {% empty %}
        <tr><td colspan="4">No referral history.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="section">
  <div class="section-header"><h2>Auto Analysis Panel</h2></div>
  <div class="results-card">
    <div class="results-title">System Insight</div>
    <div class="results-sub">{{ insight }}</div>
  </div>
</section>
{% endblock %}
