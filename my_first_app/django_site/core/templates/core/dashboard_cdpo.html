{% extends 'base.html' %}
{% block title %}CDPO Dashboard{% endblock %}
{% block content %}
<section class="section">
  <div class="section-header"><h2>{{ title }}</h2><span class="tag">Role: CDPO / Mandal</span></div>
  <form class="filter-row" method="get">
    <label>Mandal ID<input type="text" name="location_id" value="{{ location_id }}" placeholder="MANDAL001"></label>
    <button class="btn primary" type="submit">Apply</button>
  </form>
  {% if alerts %}
    <div class="alerts-wrap">{% for a in alerts %}<div class="alert-line">{{ a.level|upper }}: {{ a.message }}</div>{% endfor %}</div>
  {% endif %}
  <div class="stat-grid">
    <div class="stat-card"><div><div class="stat-value">{{ total_children }}</div><div class="stat-label">Children in Mandal</div></div></div>
    <div class="stat-card"><div><div class="stat-value">{{ high_risk_children }}</div><div class="stat-label">High/Critical</div></div></div>
    <div class="stat-card"><div><div class="stat-value">{{ followup_compliance }}%</div><div class="stat-label">Follow-up Compliance</div></div></div>
    <div class="stat-card"><div><div class="stat-value">{{ screening_coverage }}%</div><div class="stat-label">Coverage</div></div></div>
  </div>
</section>
<section class="section">
  <div class="section-header"><h2>Risk Heatmap (Mandal Hotspots)</h2></div>
  <div class="table-wrap">
    <table class="kpi-table">
      <thead><tr><th>Mandal</th><th>High Risk %</th></tr></thead>
      <tbody>
        {% for h in hotspots %}
          <tr><td>{{ h.mandal_id }}</td><td>{{ h.high_risk_pct }}</td></tr>
        {% empty %}
          <tr><td colspan="2">No hotspot above 15% threshold.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
<section class="section">
  <div class="section-header"><h2>Trend</h2></div>
  <div class="table-wrap">
    <table class="kpi-table">
      <thead><tr><th>Month</th><th>Screenings</th><th>High Risk</th><th>High Risk %</th></tr></thead>
      <tbody>
        {% for row in trend_rows %}
          <tr><td>{{ row.month }}</td><td>{{ row.screenings }}</td><td>{{ row.high_risk }}</td><td>{{ row.high_risk_pct }}</td></tr>
        {% empty %}
          <tr><td colspan="4">No trend data.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
